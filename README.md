# Infra DNS : система доменных имен

**Описание** : облачная DNS-лаборатория с полным циклом разрешения доменных имен и мониторингом. Реализация инфраструктуры системы, имитирующей классическую иерархию, начиная с корневого сервера, и заканчивая доменными записями, на базе платформы Yandex Cloud. Проект реализован для демонстрация понимания работы сетевых протоколов, принципов системной инженерии и ключевых DevOps-концепций (*IaC, Observability и т.д.*).

## Архитектура

### Слой 1 : Terraform : облачная инфраструктура

Изолированная программно-определяемая сеть (*SDN*) с политиками безопасности Zero-Trust.

- **VPC :** сеть (`dns-net`), подсеть (`10.0.0.0/24`), шлюз и таблица маршрутизации
- **Security Groups :** SSH-доступ (`bastion`), внутренние DNS-серверы (`core`), ELK-стек (`elasticsearch`)
- **Виртуальные машины : (`Debian 12`)**
  - `dns-ins-bastion` - SSH-шлюз
  - `dns-ins-root` - корневой сервер для зоны (`.`)
  - `dns-ins-top-level-domain` - TLD сервер для зоны (`domain`)
  - `dns-ins-authoritative-{a,b}` - авторитативные серверы (*master/slave*) для зоны (`subdomain.domain`)
  - `dns-ins-recursor` - рекурсивный кеширующий резолвер
  - `dns-ins-stub` - хост с нагрузочным Docker контейнером (*Go скрипт*)
  - `dns-ins-elk` - ELK стек (*Logstash, Elasticsearch и Kibana*) 

### Слой 2 : Ansible + Bind9 : система доменных имен

Ansible-плейбуки (`infra-*`), выполняющие идемпотентное развертывание иерархии разрешения доменных имен.

- **Иерархия и делегирование :**
  - `root` -> делегирование `domain.` -> `tldd`
  - `tldd` -> делегирование `subdomain.domain.` -> `au_a`/`au_b`
  - `au_a`/`au_b` - хранение конечных записей (A, AAAA)
- **Роли :**
  - **Авторитативные :** `root`, `tldd`, `au_a`, `au_b`
  - **Рекурсивный :** `recr`
  - **Клиентский :** `stub`
- **Особенности :**
  - Валидация конфигураций (`named-checkconf` + `named-checkzone`)
  - Идемпотентное развертывание
  - Конфигурация логирования запросов

### Слой 3 : ELK Stack + Vector : мониторинг

- **Сбор логов :** vector-агенты (`elk-agent.yaml`) на каждом узле DNS инфраструктуры, отправляющие логи Bind9 в Logstash
- **Агрегация и визуализация :** Docker Compose стек (`elk-stck.yaml`) на хосте `elko` (`elasticsearch`, `logstash` + `kibana`)
- **Автоматическая конфигурация :** автоматическое создание Data View в Kibana для анализа трафика

### Слой 4 : Go-скрипт : тестирование

Кастомный скрипт (`stub/`), выполняющий роль stub-резолвера.

- **Назначение :** генерация имитации реалистичного DNS-трафика для тестирования инфраструктуры
- **Особенности :**
  - Переменная нагрузка (случайное число запросов и временные интервалы)
  - Переменный список доменой через `DOMAINS`
  - Логгирование результатов запросов и ошибок разрешения
- **Развертывание :** запуск в Docker-контейнере на хосте `stub` (плейбук `infra-stub.yaml`)

## Технологии и навыки

| Категория | Технологии/Инструменты | Навыки |
| :-- | :-- | :-- |
| **Cloud & IaC** | Yandex Cloud, Yandex Provider, Terraform | Программное определение инфраструктуры, работа с VPC, Security Groups, автоматическая генерация ключей |
| **Configuration Management** | Ansible, Jinja2 | Идемпотентная настройка распределённых систем, работа с шаблонами, управление сервисами |
| **Monitoring & Observability** | ELK Stack (Elasticsearch, Logstash, Kibana), Vector | Централизованный сбор и анализ логов, настройка пайплайнов данных, парсинг текстовых записей, визуализация метрик |
| **Networking & DNS** | BIND9 (авторитативный/рекурсивный), DNS-протокол (UDP/TCP)| Понимание архитектуры DNS : зон, делегирования, рекурсивного и авторитативного резолвинга |
| **Containers & Development** | Docker, Go | Разработка скриптов, контейнеризация, работа с переменными окружения |
| **Automation** | Динамический инвентарь Ansible, генерация конфигураций в Terraform | Автоматизация полного цикла развёртывания, интеграция между инструментами |
| **Security** | Security Groups (Zero-Trust), SSH-ключи (Ed25519), изоляция сети, бастион хост | Безопасность облачной инфраструктуры, принцип минимальных привилегий |

# TODO
- stub : реализовать логирование : подключать к контейнеру директорию, писать в нее логи, читать vector, парсить logstash, подмешивать в dataview
- elasticsearch : реализовать политики хранения логов : 1 час достаточно
- написать баш скрипт для развертывания склонированного репозитория : скопировал, запустил скрипт, terraform, ansible, вернулась ссылка на кибану, где все видно и понятно
- перепроверить и оформить README.md : описать развертывание для пользователей : описать что пользователю ожидать от проекта
